# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- master

jobs:

- job: 'Linux'
  displayName: 'Linux'

  pool:
    vmImage: 'ubuntu-latest'

  steps:
  - task: UsePythonVersion@0
    inputs:
      versionSpec: '3.X'
      architecture: 'x64'

  - script: |
      python -m pip install --upgrade pip
      python -m pip install numpy psutil ninja cmake scikit-build
    displayName: 'Install build dependencies'

  - script: |
      python setup.py clean
      python -m pip install .
      python blosc/test.py
    displayName: 'Test'

  - script: |
      docker pull dockcross/manylinux1-x64
      docker run dockcross/manylinux1-x64 > ./dockcross-manylinux-x64
      chmod +x ./dockcross-manylinux-x64
      ./dockcross-manylinux-x64 ./.build_wheels_in_manylinux.sh
    displayName: 'Build wheel'

  - task: PublishPipelineArtifact@0
    inputs:
      artifactName: 'LinuxWheels'
      targetPath: './dist'
